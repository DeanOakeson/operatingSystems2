#include "errorhandler.h"
ErrorHandler::ErrorHandler(VirtualMachine &machine) : machine(machine) {}

void ErrorHandler::errorDump() {
  printf("\n[OS] --ERROR_DUMP  \n=================\n");
  for (const int &i : errorList) {
    switch (i) {
    case CPU_EARLY_TERMINATION:
      printf("[OS][100] --cpu early termination\n");
      break;
    case MEM_OVERFLOW:
      printf("[OS][201] --memory overflow--\n");
      break;
    case MEM_OVERWRITE:
      printf("[OS][202] --attempted memory overwrite--\n");
      break;
    case MEM_FSTREAM_ERR_1:
      break;
    case MEM_FSTREAM_ERR_2:
      break;
    case MEM_FSTREAM_ERR_3:
      break;
    case MEM_DUMP_NO_PROGRAM:
      printf("[OS][301] --attempted memDump() no loaded program--\n");
      break;
    }
  }
  printf("\n");
}

void ErrorHandler::coreDump() {
  u_int8_t regId = 0;

  printf("\n[OS] --CORE_DUMP  \n================");
  for (u_int8_t i = 0; i < 6; i++) {
    printf("\nREGISTER:: [ %d ] -- [ %d ]", regId, machine.reg[regId]);
    regId += 1;
  }
  printf("\nREGISTER:: [ PC ] -- [ %d ] \nREGISTER:: [ Z ] -- "
         "[ %d ]\n\n",
         machine.PC, machine.Z);
}

int ErrorHandler::memDump() {
  if (Machine.MainMemory.fileSize == 0) { // IF NO FILE HAS BEEN LOADED
    printf("[OS][301] --attempted memDump() with no loaded program\n");
    errorList.push_back(MEM_DUMP_NO_PROGRAM);
    return 301; // 1 memDump means no load
  }
  printf("\n[OS] --MEM_DUMP  \n===========\nADDRESSES::[ %d - "
         "%d ]\nPROGRAM::[ %s ]\n",
         Machine.MainMemory.fileLoadAddress,
         Machine.MainMemory.fileLoadAddress + Machine.MainMemory.fileSize,
         filePath.c_str());
  for (int i = Machine.MainMemory.fileLoadAddress;
       i < Machine.MainMemory.fileLoadAddress + Machine.MainMemory.fileSize;
       i++) {
    printf("\nADDRESS::[ %d ] -- ", i);
    for (int j = 0; j <= 6; j++) {
      printf("[ %d ]", Machine.MainMemory.mem[i][j]);
    }
  }
  printf("\n\n");
  return 0;
}
